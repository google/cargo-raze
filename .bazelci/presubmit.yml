---
buildifier: latest
tasks:
  # Tests are currently non-hermetic and depend upon a cargo binary, hence the shell_commands.
  # TODO(acmcarther): Fix
  # TODO(acmcarther): Add check to verify that examples are up-to-date.
  ubuntu1804:
    shell_commands:
      - "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y"
    test_flags:
      - "--test_env=CARGO=$HOME/.cargo/bin/cargo"
    build_targets:
      - "..."
    test_targets:
      - "..."
  windows:
    batch_commands:
      - "curl.exe https://win.rustup.rs/ -o rustup-init.exe"
      - "rustup-init.exe -y --default-host x86_64-pc-windows-msvc --default-toolchain nightly"
    test_flags:
      - "--test_env=CARGO=%USERPROFILE%\\.cargo\\bin\\cargo.exe"
    build_targets:
      - "..."
    test_targets:
      - "..."
  macos:
    shell_commands:
      - "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y"
    test_flags:
      - "--test_env=CARGO=$HOME/.cargo/bin/cargo"
    build_targets:
      - "..."
    test_targets:
      - "..."
